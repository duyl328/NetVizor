<UserControl
    x:Class="Shell.UserControls.NetworkMonitorView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:viewModel="clr-namespace:Shell.ViewModel"
    xmlns:converters="clr-namespace:Shell.Converters"
    mc:Ignorable="d"
    d:DesignHeight="120"
    d:DesignWidth="200"
    Background="Transparent">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:InvertedBooleanToVisibilityConverter x:Key="InvertedBooleanToVisibilityConverter" />
    </UserControl.Resources>

    <d:UserControl.DataContext>
        <viewModel:NetworkMonitorViewModel />
    </d:UserControl.DataContext>

    <Border
        x:Name="MainBorder"
        CornerRadius="8"
        Background="#F0FFFFFF"
        BorderBrush="#20000000"
        BorderThickness="1"
        Margin="5">
        <Border.Effect>
            <DropShadowEffect
                ShadowDepth="2"
                Direction="315"
                Color="#40000000"
                Opacity="0.3"
                BlurRadius="8" />
        </Border.Effect>

        <Grid Margin="10,8">
            <StackPanel x:Name="MainPanel" Orientation="Vertical">
                <!-- Global Speed Panel -->
                <StackPanel x:Name="SpeedPanel" Orientation="Vertical" HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <!-- Upload Speed -->
                    <Grid x:Name="UploadGrid">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            Grid.Column="0"
                            Text="↑"
                            Foreground="#FF6B6B"
                            FontSize="12"
                            FontWeight="Bold"
                            VerticalAlignment="Center"
                            Margin="0,0,6,0" />
                        <TextBlock
                            x:Name="UploadSpeedText"
                            Grid.Column="1"
                            Text="{Binding UploadSpeed}"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="#333333"
                            VerticalAlignment="Center" />
                    </Grid>

                    <!-- Download Speed -->
                    <Grid x:Name="DownloadGrid" Margin="0,5,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            Grid.Column="0"
                            Text="↓"
                            Foreground="#4ECDC4"
                            FontSize="12"
                            FontWeight="Bold"
                            VerticalAlignment="Center"
                            Margin="0,0,6,0" />
                        <TextBlock
                            x:Name="DownloadSpeedText"
                            Grid.Column="1"
                            Text="{Binding DownloadSpeed}"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="#333333"
                            VerticalAlignment="Center" />
                    </Grid>
                </StackPanel>

                <!-- Network Top List Panel -->
                <StackPanel x:Name="TopListPanel" Orientation="Vertical" Margin="0,8,0,0"
                            Visibility="{Binding TopListVisibility}">
                    <!-- Separator Line -->
                    <Border Height="1" Background="#E0E0E0" Margin="0,0,0,6" />

                    <!-- Top List Items -->
                    <ItemsControl x:Name="TopListItems" ItemsSource="{Binding TopProcesses}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="16" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" MinWidth="40" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!-- App Icon or Initial Letter -->
                                    <Grid Grid.Column="0" Width="12" Height="12" VerticalAlignment="Center">
                                        <!-- Process Icon -->
                                        <Image Source="{Binding IconSource}"
                                               Visibility="{Binding HasIcon, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                        <!-- Initial Letter Fallback -->
                                        <Border Background="{Binding InitialBackgroundColor}"
                                                CornerRadius="6"
                                                Visibility="{Binding HasIcon, Converter={StaticResource InvertedBooleanToVisibilityConverter}}">
                                            <TextBlock Text="{Binding InitialLetter}"
                                                       FontSize="8"
                                                       FontWeight="Bold"
                                                       Foreground="White"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       Margin="0,-1,0,0" />
                                        </Border>
                                    </Grid>

                                    <!-- App Name -->
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ProcessName}"
                                               FontSize="10"
                                               FontWeight="Normal"
                                               Foreground="#666666"
                                               VerticalAlignment="Center"
                                               Width="45"
                                               TextTrimming="CharacterEllipsis"
                                               TextAlignment="Left"
                                               Margin="4,0,1,0" />

                                    <!-- Upload Speed -->
                                    <Grid Grid.Column="3">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="↑"
                                                   Foreground="#FF6B6B" FontSize="10"
                                                   VerticalAlignment="Center" Margin="0,0,2,0" />
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding FormattedUploadSpeed}"
                                                   FontSize="10" FontWeight="Normal"
                                                   Foreground="#666666"
                                                   VerticalAlignment="Center"
                                                   Width="35"
                                                   TextAlignment="Right"
                                                   FontFamily="Consolas" />
                                    </Grid>

                                    <!-- Download Speed -->
                                    <Grid Grid.Column="4" Margin="4,0,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="↓"
                                                   Foreground="#4ECDC4" FontSize="10"
                                                   VerticalAlignment="Center" Margin="0,0,2,0" />
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding FormattedDownloadSpeed}"
                                                   FontSize="10" FontWeight="Normal"
                                                   Foreground="#666666"
                                                   VerticalAlignment="Center"
                                                   Width="35"
                                                   TextAlignment="Right"
                                                   FontFamily="Consolas" />
                                    </Grid>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>